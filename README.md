# MLR-Notification-Service
[![Build Status](https://travis-ci.org/USGS-CIDA/MLR-Notification-Service.svg?branch=master)](https://travis-ci.org/USGS-CIDA/MLR-Notification-Service) [![Coverage Status](https://coveralls.io/repos/github/USGS-CIDA/MLR-Notification-Service/badge.svg?branch=master)](https://coveralls.io/github/USGS-CIDA/MLR-Notification-Service?branch=master)


MLR Service to Email Processing Result Notifications to Users

## Running the Application
Copy the application-test.yml file from the project root directory to an "application.yml" file also at the project root directory and change the values as needed.
Open a terminal and cd to the project root directory. Within this directory run 
```
mvn spring-boot:run -Djavax.net.ssl.trustStore=/absolute/path/to/your/trust-store.jks -Djavax.net.ssl.trustStorePassword=yourtruststoresreadme
``` 
and then the application will launch and be available at http://localhost:8080/swagger-ui.html. 
The two parameters are needed if the authPublicKeyUrl requires a certificate. The trust store should contain the certificate for that url.

## Profiles
This application has two built-in Spring Profiles to aid with local development.

The **default** profile will enable Authentication. The **swagger** profile will enable the swagger documentation. By
default the project has both profiles. For local development, it may be convenient to specify only **swagger**.

## Environment Variables
* MLR_NOTIFICATION_EMAIL_FROM - The email address to send emails from this service as. I.E: The `from` address for emails generated by this service.

* MLR_NOTIFICATION_EMAIL_HOST - The host address of the smtp server to connect to

* MLR_NOTIFICATION_EMAIL_PORT - The port of the smtp server to connect to


## Running the Application

This application can be run locally using the docker container built during the build process or by directly building and running the application JAR. The included `docker-compose` file has 3 profiles to choose from when running the application locally:

1. mlr-notification-service: This is the default profile which runs the application as it would be in our cloud environment. This is not recommended for local development as it makes configuring connections to other services running locally on your machine more difficult.
2. mlr-notification-service-local-dev: This is the profile which runs the application as it would be in the aqcu-local-dev project, and is configured to make it easy to replace the aqcu-gateway instance in the local-dev project with this instance. It is run the same as the `mlr-notification-service` profile, except it uses the docker host network driver.
3. mlr-notification-service-debug: This is the profile which runs the application exactly the same as `mlr-notification-service-local-dev` but also enables remote debugging for the application and opens up port 8000 into the container for that purpose.

Before any of these options are able to be run you must also generate certificates for this application to serve using the `create_certificates` script in the `docker/certificates` directory. Additionally, this service must be able to connect to a running instance of Water Auth when starting, and it is recommended that you use the Water Auth instance from the `mlr-notification-service-local-dev` project to accomplish this. In order for this application to communicate with any downstream services that it must call, including Water Auth, you must also place the certificates that are being served by those services into the `docker/certificates/import_certs` directory to be imported into the Java TrustStore of the running container.

To build and run the application after completing the above steps you can run: `docker-compose up --build {profile}`, replacing `{profile}` with one of the options listed above.